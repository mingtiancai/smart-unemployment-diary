# 1.C++

## 1.1 向线程函数传递参数

传递进入线程函数的参数，先被拷贝进入线程空间，然后线程函数再调用这些参数。

```cpp
//线程函数声明
void f(int i,std::string& s);

//调用函数定义
void oops(int param)
{
    char buf[1024];
    sprintf(buf,"%i",param);
    thread t(f,2,buf);
    t.detach();
}

```

oops函数中往线程空间传递的是指向临时变量的指针，所以被拷贝进线程空间的首先就是指针，然后在调用f函数的时候，再将指针对应的字符串转化为本地的string对象。如果在转化string对象前，oops函数结束了，行为未定义，这是很严重的问题。

一种解决办法是说，在拷贝之前先把本地变量对应的数据转成string对象拷贝进入线程空间，这样后面不论oops函数中怎么样，线程空间是有完整字符串数据副本的。

```cpp
//线程函数声明
void f(int i,std::string& s);

//调用函数定义
void oops(int param)
{
    char buf[1024];
    sprintf(buf,"%i",param);
    thread t(f,2,string(buf));
    t.detach();
}
···

